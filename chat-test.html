<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test n8n Chat</title>
</head>
<body>
    <h1>Test n8n Chat Integration</h1>
    <p>This page tests different n8n chat configurations. Check the console for errors.</p>
    
    <h2>Option 1: Official n8n Chat Widget</h2>
    <div id="chat-container-1"></div>
    
    <h2>Option 2: Custom Implementation</h2>
    <div id="custom-chat" style="border: 1px solid #ccc; padding: 20px; max-width: 400px;">
        <div id="messages" style="height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; margin-bottom: 10px;">
            <div>Bot: Hola, ¿en qué puedo ayudarte?</div>
        </div>
        <input type="text" id="message-input" placeholder="Escribe tu mensaje..." style="width: 70%;">
        <button onclick="sendMessage()">Enviar</button>
    </div>
    
    <h2>Test Results:</h2>
    <div id="test-results" style="background: #f0f0f0; padding: 10px; font-family: monospace;"></div>

    <!-- Official n8n Chat Widget -->
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
    <script type="module">
        import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';
        
        console.log('Loading n8n chat widget...');
        
        try {
            // Try with the current webhook URL
            const chat = createChat({
                webhookUrl: 'https://n8n.automationbeast.win/webhook/5f1c0c82-0ff9-40c7-9e2e-b1a96ffe24cd',
                mode: 'window',
                chatInputKey: 'chatInput',
                chatSessionKey: 'sessionId',
                initialMessages: ['Test message from n8n chat widget'],
                showWelcomeScreen: false,
                loadPreviousSession: false
            });
            
            console.log('Chat widget created successfully:', chat);
            document.getElementById('test-results').innerHTML += '<div>✅ Widget loaded successfully</div>';
        } catch (error) {
            console.error('Error creating chat:', error);
            document.getElementById('test-results').innerHTML += '<div>❌ Widget error: ' + error.message + '</div>';
        }
    </script>
    
    <!-- Custom Implementation for Testing -->
    <script>
        const webhookUrls = [
            'https://n8n.automationbeast.win/webhook/5f1c0c82-0ff9-40c7-9e2e-b1a96ffe24cd',
            'https://n8n.automationbeast.win/webhook-test/5f1c0c82-0ff9-40c7-9e2e-b1a96ffe24cd',
            'https://n8n.automationbeast.win/webhook/5f1c0c82-0ff9-40c7-9e2e-b1a96ffe24cd/chat'
        ];
        
        async function testWebhook(url) {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML += `<div>Testing: ${url}</div>`;
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chatInput: 'Test message',
                        sessionId: 'test-' + Date.now(),
                        action: 'sendMessage'
                    })
                });
                
                const statusText = response.ok ? '✅' : '❌';
                resultsDiv.innerHTML += `<div>${statusText} Status: ${response.status} ${response.statusText}</div>`;
                
                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML += `<div>Response: ${JSON.stringify(data).substring(0, 100)}...</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div>❌ Error: ${error.message}</div>`;
            }
            
            resultsDiv.innerHTML += '<hr>';
        }
        
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value;
            if (!message) return;
            
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML += `<div>You: ${message}</div>`;
            
            // Test all webhook URLs
            for (const url of webhookUrls) {
                await testWebhook(url);
            }
            
            input.value = '';
        }
        
        // Test webhooks on load
        window.addEventListener('load', async () => {
            console.log('Testing webhooks...');
            for (const url of webhookUrls) {
                await testWebhook(url);
            }
        });
    </script>
</body>
</html>